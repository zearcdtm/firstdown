import discord from discord.ext import commands from discord import app_commands, Interaction, Embed, AllowedMentions from datetime import datetime GUILD_ID = 1443687099575570544 class ReportGame(commands.Cog): def __init__(self, bot): self.bot = bot @app_commands.command( name="reportgame", description="Report a game result with stats" ) @app_commands.guilds(discord.Object(id=GUILD_ID)) @app_commands.describe( week="Week number of the season", winning_team="Winning team role mention", losing_team="Losing team role mention", result="Format: winnerScore-loserScore, e.g. 21-14", subtitle_text="Optional text under the title", winner_passing="Winning team passing stats file", winner_rushing="Winning team rushing stats file", winner_receiving="Winning team receiving stats file", winner_defensive="Winning team defensive stats file", loser_passing="Losing team passing stats file", loser_rushing="Losing team rushing stats file", loser_receiving="Losing team receiving stats file", loser_defensive="Losing team defensive stats file" ) async def reportgame( self, interaction: Interaction, week: int, winning_team: discord.Role, losing_team: discord.Role, result: str, subtitle_text: str = None, winner_passing: discord.Attachment = None, winner_rushing: discord.Attachment = None, winner_receiving: discord.Attachment = None, winner_defensive: discord.Attachment = None, loser_passing: discord.Attachment = None, loser_rushing: discord.Attachment = None, loser_receiving: discord.Attachment = None, loser_defensive: discord.Attachment = None ): await interaction.response.defer() # Parse the result try: winner_score, loser_score = map(int, result.split("-")) except: await interaction.followup.send( "‚ùå Invalid result format. Use winner-loser numbers, e.g., 21-14.", ephemeral=True ) return # Send winning team files winner_files = [f for f in [winner_passing, winner_rushing, winner_receiving, winner_defensive] if f] if winner_files: files = [await f.to_file() for f in winner_files] await interaction.channel.send(files=files) # Build main embed embed = Embed( title=f"**First Down | Week {week} Recaps**", description=f"{winning_team.mention} {winner_score} üèÜ\n{losing_team.mention} {loser_score}", color=discord.Color.green() ) if subtitle_text: embed.set_author(name=subtitle_text) embed.set_footer(text=f"Submitted by {interaction.user} ‚Ä¢ {datetime.now().strftime('%Y-%m-%d %H:%M')}") allowed = AllowedMentions(roles=True) # Send the embed embed_msg = await interaction.followup.send(embed=embed, allowed_mentions=allowed, wait=True) # Send losing team files loser_files = [f for f in [loser_passing, loser_rushing, loser_receiving, loser_defensive] if f] if loser_files: files = [await f.to_file() for f in loser_files] await embed_msg.reply(files=files) async def setup(bot): await bot.add_cog(ReportGame(bot))
